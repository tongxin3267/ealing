{"version":3,"sources":["webpack:///src/views/ImMessage.vue","webpack:///./src/views/ImMessage.vue?2404","webpack:///./src/views/ImMessage.vue","webpack:///src/views/Message.vue","webpack:///./src/views/Message.vue?e4c9","webpack:///./src/views/Message.vue","webpack:///./src/views/Message.vue?b364"],"names":["MoreIcon","More","BackIcon","Back","currentUserId","goTo","changeUrl","_this","this","getTime","user_id","hash","message","Object","webSocket","sendmsg","msg","cid","currentUser","content","dbMsg","catch","e","_messagelist$key","types","room","_room","_this2","scrollHeight","lists","_userInfo$avatar","userInfo","avatar","_this3","targetUserId","itemTarget","user","item","views_ImMessage","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","gutter","staticStyle","display","justify-content","span","nativeOn","click","$event","height","width","color","_v","_s","targetUser","name","id","_l","src","txt","_e","myAvatar","alt","directives","rawName","maxLength","type","placeholder","autosize","minRows","maxRows","model","value","callback","$$v","$set","expression","size","long","disabled","canSend","staticRenderFns","Component","__webpack_require__","normalizeComponent","ImMessage","ssrContext","__webpack_exports__","Message","ToolBar","DiggIcon","Digg","CommentIcon","Comment","isWeiXin","computed","extends_default","vuex_esm","messageCount","stores_types","messageList","_messageCount$diggs","diggs","uids","uid","oldIds","_count","count","digg","_user$name","_user$name2","length","_messageCount$comment","comments","_count2","timers","timer","i","newArr","nowtime","then","response","data","key","chatroom","orderBy","filter","limit","reverse","toArray","results","messagebase","array","time","messageBody","li","views_Message","offset","class","$style","entryLists","entry","entryContainer","on","entryIcon","commentIcon","border-radius","padding","font-weight","font-size","commentsText","since","commentTime","locale","auto-update","diggIcon","diggsText","diggTime","index","messageAvatar","messagePreview","padding-top","module","exports"],"mappings":"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","file":"static/js/8.a050960236a2c31dde3e.js","sourcesContent":["<template>\n\t<div class=\"imMessage\">\n\t\t<div class=\"commonHeader\">\n      <Row :gutter=\"24\">\n        <Col span=\"5\" style=\"display: flex; justify-content: flex-start\" @click.native=\"goTo(-1)\">\n          <BackIcon height=\"21\" width=\"21\" color=\"#999\" />\n        </Col>\n        <Col span=\"14\" class=\"title-col\">\n          {{targetUser.name}}\n        </Col>\n        <Col span=\"5\" class=\"header-end-col\">\n          <!-- <MoreIcon width=\"21\" height=\"21\" color=\"#333\" /> -->\n        </Col>\n      </Row>\n    </div>\n\t\t<div class=\"messageList\" id=\"messagelists\">\n\t\t\t<div class=\"message\" v-for=\"msg in messagelists\">\n\t\t\t\t<div class=\"hemessage\" v-if=\"msg.user_id !== currentUser\" >\n\t\t\t\t\t<img :src=\"room.avatar\" class=\"avatar\">\n\t\t\t\t\t<div class=\"content\">\n\t\t\t\t\t\t<h5 class=\"name\">{{room.name}}</h5>\n\t\t\t\t\t\t<div class=\"msg-content\"> \n\t\t\t\t\t\t\t{{msg.txt}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"mymessage\" v-if=\"msg.user_id == currentUser\" >\n\t\t\t\t\t<div class=\"content\">\n\t\t\t\t\t\t<h5 class=\"name\">{{userInfo.name}}</h5>\n\t\t\t\t\t\t<div class=\"msg-content\"> \n\t\t\t\t\t\t\t{{msg.txt}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<img :src=\"myAvatar\" alt=\"\" class=\"avatar\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"sendBox\">\n\t\t\t<Row :gutter=\"16\" style=\"width: 100%;\">\n\t\t\t\t<Col span=\"20\">\n\t\t\t\t\t<Input v-childfocus :maxLength=\"255\" type=\"textarea\" class=\"commentInput\" v-model=\"message.content\" placeholder=\"say anything\" :autosize=\"{minRows: 1,maxRows: 4}\" />\n\t\t\t\t</Col>\n\n\t\t\t\t<Col span=\"4\">\n\t\t\t\t\t<Button size=\"small\" class=\"sendButton\" :long=\"true\" :disabled=\"canSend\" type=\"primary\" @click.native=\"sendmsg()\">发送</Button>\n\t\t\t\t</Col>\n\t\t\t</Row>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\n\timport { getUserInfo } from '../utils/user';\n\timport localEvent from '../stores/localStorage';\n\timport { NOTICE, TOTALMESSAGELISTS, TOTALMESSAGELIST, CLEANNEWMESSAGE } from '../stores/types';\n\timport MoreIcon from '../icons/More';\n\timport BackIcon from '../icons/Back';\n\timport lodash from 'lodash';\n\timport { goTo, changeUrl } from '../utils/changeUrl';\n\timport { connect } from '../utils/webSocket';\n\timport { getDatas } from '../utils/localDatabase';\n\timport { mapState, mapGetters } from 'vuex';\n\n\tconst imMessage = {\n\t\tcomponents: {\n\t\t\tMoreIcon,\n\t\t\tBackIcon\n\t\t},\n\t\tdata: () => ({\n\t\t\ttargetUser: { \n\n\t\t\t},\n\t\t\tcurrentUser: window.TS_WEB.currentUserId,\n\t\t\tuserInfo: {},\n\t\t\tcid: 0,\n\t\t\tuser_id: 0,\n\t\t\tmessage: {\n\t\t\t\tcontent: '',\n\t\t\t\tmax_id: 0\n\t\t\t}\n\t\t}),\n\t\tmethods: {\n\t\t\tgoTo,\n\t\t\tchangeUrl,\n\t\t\tsendmsg() {\n\t\t\t\tlet msg = '2';\n\t\t\t\tlet time = (new Date()).getTime();\n\t\t\t\tlet hash = time + '_' +this.user_id;\n\t\t\t\tlet message = [\n\t\t\t\t\t'convr.msg',\n\t\t\t\t\t{\n\t\t\t\t    \"cid\": this.cid, // 对话id\n\t\t\t\t    \"type\": 0, // 消息的类型，私密消息\n\t\t\t\t    \"txt\": this.message.content, // 消息的文本内容，字符串，可选，默认空字符串\n\t\t\t\t    \"rt\": false, // 非实时消息\n\t\t\t\t\t},\n\t\t\t\t\thash\n\t\t\t\t];\n\t\t\t\tmsg += JSON.stringify(message);\n\t\t\t\tif(!TS_WEB.webSocket) {\n\t\t\t\t\tthis.$store.dispatch(NOTICE, cb => {\n\t\t\t\t\t\tcb({\n\t\t\t\t\t\t\tshow: true,\n\t\t\t\t\t\t\ttime: 1500,\n\t\t\t\t\t\t\tstatus: false,\n\t\t\t\t\t\t\ttext: '链接出错,可能是没有配置聊天服务器'\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif(TS_WEB.webSocket.readyState != 1) {\n\t\t\t\t\tconnect();\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tif(TS_WEB.webSocket.readyState == 1) {\n\t\t\t\t\t\t\tthis.sendmsg();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 1000);\n\t\t\t\t} else {\n\t\t\t\t\tTS_WEB.webSocket.send(msg);\n\t\t\t\t\tlet dbMsg = {\n\t\t\t\t\t\t\tcid: this.cid,\n\t\t\t\t\t\t\tuid: this.currentUser,\n\t\t\t\t\t\t\ttxt: this.message.content,\n\t\t\t\t\t\t\thash,\n\t\t\t\t\t\t\tmid: 0,\n\t\t\t\t\t\t\tseq: -1,\n\t\t\t\t\t\t\ttime: 0,\n\t\t\t\t\t\t\towner: window.TS_WEB.currentUserId\n\t\t\t\t\t\t};\n\t\t\t\t\twindow.TS_WEB.dataBase.transaction('rw?', window.TS_WEB.dataBase.messagebase, () => {\n\t\t\t\t\t\twindow.TS_WEB.dataBase.messagebase.put(dbMsg);\n\t\t\t\t\t})\n\t\t\t\t\t.catch (function (e) {\n\t\t\t\t    console.error(\"Generic error: \" + e);\n\t\t\t\t\t});\n\t\t\t\t\tthis.message.content = '';\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcomputed: {\n\t\t\troom() {\n\t\t\t\tlet messagelist = this.$store.getters[TOTALMESSAGELISTS];\n\t\t\t\tconst key = `room_${this.cid}`;\n\t\t\t\tconst { [key]: room = {} } = messagelist;\n\t\t\t\treturn room;\n\t\t\t},\n\t\t\tmessagelists () {\n\t\t\t\tconst { lists = [], count = 0 } = this.room;\n\t\t\t\tthis.$nextTick( function () {\n\t\t\t\t\t// 在当前会话时，清除当前会话的message提示数量\n\t\t\t\t\tif(count != 0) {\n\t\t\t\t\t\tthis.$store.dispatch(CLEANNEWMESSAGE, cb => {\n\t\t\t\t\t\t\tcb(this.cid);\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\twindow.scrollTo(0,document.body.scrollHeight)\n\t\t\t\t});\n\t\t\t\treturn lists;\n\t\t\t},\n\t\t\tmyAvatar () {\n\t\t\t\tconst { avatar = '' } = this.userInfo;\n\t\t\t\treturn avatar;\n\t\t\t},\n\t\t\tcanSend () {\n\t\t\t\tlet message = this.message.content;\n\t\t\t\tmessage = message.replace(/(^\\s*)|(\\s*$)/g,\"\");\n\t\t\t\tmessage = message.replace(\" \",\"\");\n\t\t\t\tif(!message.length) {\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcreated () {\n\t\t\t// target user_id \n\t\t\tlet targetUserId = this.user_id = this.$route.params.user_id;\n\t\t\tthis.cid = parseInt(this.$route.params.cid);\n\t\t\tif(!targetUserId) {\n\t\t\t\tthis.$store.dispatch(NOTICE, cb => {\n\t\t\t\t\tcb({\n\t\t\t\t\t\ttext: 'got some errors',\n            time: 1500,\n            status: false,\n            show: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t\t// miss main param, go back\n\t\t\t\tsetTimeout( () => {\n\t\t\t\t\tthis.$router.go(-1);\n\t\t\t\t}, 1600);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// load target user info;\n\t\t\tlet itemTarget = this.$storeLocal.get(targetUserId);\n\n\t\t\tif(itemTarget !== undefined) {\n\t\t\t\tthis.targetUser = { ...itemTarget };\n\t\t\t} else {\n\t\t\t\tgetUserInfo(targetUserId, 30).then( user => {\n\t\t\t\t\tthis.targetUser = { ...user };\n\t\t\t\t})\n\t\t\t}\n\n\t\t\t// load logged on userinfo\n\t\t\t\n\t\t\tlet item = this.$storeLocal.get(window.TS_WEB.currentUserId);\n\t\t\tif(item !== undefined) {\n\t\t\t\tthis.userInfo = { ...item };\n\t\t\t} else {\n\t\t\t\tgetUserInfo(window.TS_WEB.currentUserId, 30).then( user => {\n\t\t\t\t\tthis.userInfo = { ...user };\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\texport default imMessage;\n</script>\n\n<style lang=\"less\" scoped>\n\t.commonHeader {\n\t\theight: 46px;\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t}\n\t.message {\n\t\tmargin: 2vh 0;\n\t}\n\t.mymessage, .hemessage {\n\t\tdisplay: flex;\n\t\talign-items: flex-start;\n\t}\n\t.hemessage {\n\t\t.msg-content {\n\t\t\tpadding: 2vw;\n\t\t  \tmax-width: 60vw;\n\t\t  \tbackground: #ededed;\n\t\t  \tcolor: #333;\n\t\t  \tborder-radius: 0 10px 10px 10px;\n\t\t  \tfloat: left;\n\t\t  \tword-break: break-all;\n\t\t}\n\t\t.content {\n\t\t\ttext-align: left;\n\t\t\tpadding-right: 2vw;\n\t\t}\n\t\t.name {\n\t\t\ttext-align: left;\n\t\t}\n\t}\n\t.mymessage {\n\t\t.msg-content {\n\t\t\tpadding: 2vw;\n\t\t  max-width: 60vw;\n\t\t  background: #59b6d7;\n\t\t  color: #333;\n\t\t  border-radius: 10px 0px 10px 10px;\n\t\t  float: right;\n\t\t  word-break: break-all;\n\t\t}\n\t\t.content {\n\t\t\ttext-align: right;\n\t\t\tpadding-left: 2vw;\n\t\t}\n\t\t.name {\n\t\t\ttext-align: right;\n\t\t}\n\t}\n\t.content {\n\t\twidth: 84vw;\n    display: inline-block;\n    .name{\n\t\t\tcolor: #999;\n\t    font-weight: normal;\n\t    line-height: 1.8;\n\t\t}\n\t}\n\t.avatar {\n\t\tpadding: 0px 2vw;\n\t  \twidth: 16vw;\n\t  \tborder-radius: 50%;\n\t  \theight: 12vw;\n\t}\n\t.sendBox {\n\t\tposition: fixed;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tmin-height: 7vh;\n\t\tmax-height: 30vh;\n\t\tpadding: 1vh 0;\n\t\tbackground: #fff;\n\n\t}\n\t.messageList {\n\t\tpadding-top: 9vh;\n\t\tpadding-bottom: 7vh;\n\t}\n</style>\n\n\n// WEBPACK FOOTER //\n// src/views/ImMessage.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"imMessage\"},[_c('div',{staticClass:\"commonHeader\"},[_c('Row',{attrs:{\"gutter\":24}},[_c('Col',{staticStyle:{\"display\":\"flex\",\"justify-content\":\"flex-start\"},attrs:{\"span\":\"5\"},nativeOn:{\"click\":function($event){_vm.goTo(-1)}}},[_c('BackIcon',{attrs:{\"height\":\"21\",\"width\":\"21\",\"color\":\"#999\"}})],1),_vm._v(\" \"),_c('Col',{staticClass:\"title-col\",attrs:{\"span\":\"14\"}},[_vm._v(\"\\n          \"+_vm._s(_vm.targetUser.name)+\"\\n        \")]),_vm._v(\" \"),_c('Col',{staticClass:\"header-end-col\",attrs:{\"span\":\"5\"}})],1)],1),_vm._v(\" \"),_c('div',{staticClass:\"messageList\",attrs:{\"id\":\"messagelists\"}},_vm._l((_vm.messagelists),function(msg){return _c('div',{staticClass:\"message\"},[(msg.user_id !== _vm.currentUser)?_c('div',{staticClass:\"hemessage\"},[_c('img',{staticClass:\"avatar\",attrs:{\"src\":_vm.room.avatar}}),_vm._v(\" \"),_c('div',{staticClass:\"content\"},[_c('h5',{staticClass:\"name\"},[_vm._v(_vm._s(_vm.room.name))]),_vm._v(\" \"),_c('div',{staticClass:\"msg-content\"},[_vm._v(\" \\n\\t\\t\\t\\t\\t\\t\\t\"+_vm._s(msg.txt)+\"\\n\\t\\t\\t\\t\\t\\t\")])])]):_vm._e(),_vm._v(\" \"),(msg.user_id == _vm.currentUser)?_c('div',{staticClass:\"mymessage\"},[_c('div',{staticClass:\"content\"},[_c('h5',{staticClass:\"name\"},[_vm._v(_vm._s(_vm.userInfo.name))]),_vm._v(\" \"),_c('div',{staticClass:\"msg-content\"},[_vm._v(\" \\n\\t\\t\\t\\t\\t\\t\\t\"+_vm._s(msg.txt)+\"\\n\\t\\t\\t\\t\\t\\t\")])]),_vm._v(\" \"),_c('img',{staticClass:\"avatar\",attrs:{\"src\":_vm.myAvatar,\"alt\":\"\"}})]):_vm._e()])})),_vm._v(\" \"),_c('div',{staticClass:\"sendBox\"},[_c('Row',{staticStyle:{\"width\":\"100%\"},attrs:{\"gutter\":16}},[_c('Col',{attrs:{\"span\":\"20\"}},[_c('Input',{directives:[{name:\"childfocus\",rawName:\"v-childfocus\"}],staticClass:\"commentInput\",attrs:{\"maxLength\":255,\"type\":\"textarea\",\"placeholder\":\"say anything\",\"autosize\":{minRows: 1,maxRows: 4}},model:{value:(_vm.message.content),callback:function ($$v) {_vm.$set(_vm.message, \"content\", $$v)},expression:\"message.content\"}})],1),_vm._v(\" \"),_c('Col',{attrs:{\"span\":\"4\"}},[_c('Button',{staticClass:\"sendButton\",attrs:{\"size\":\"small\",\"long\":true,\"disabled\":_vm.canSend,\"type\":\"primary\"},nativeOn:{\"click\":function($event){_vm.sendmsg()}}},[_vm._v(\"发送\")])],1)],1)],1)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-4ca6dbf7\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/ImMessage.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-4ca6dbf7\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./ImMessage.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ImMessage.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ImMessage.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-4ca6dbf7\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./ImMessage.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-4ca6dbf7\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/ImMessage.vue\n// module id = null\n// module chunks = ","<template>\n  <div class=\"messageList\">\n    <div class=\"commonHeader\">\n      <Row :gutter=\"24\">\n        <Col span=\"14\" offset=\"5\" class=\"title-col\">\n          消息\n        </Col>\n      </Row>\n    </div>\n    <div :class=\"$style.entryLists\">\n      <Row :gutter=\"24\" :class=\"$style.entry\" >\n        <div :class=\"$style.entryContainer\" @click=\"changeUrl('/users/mycomments')\">\n          <Col span=\"4\" :class=\"$style.entryIcon\">\n            <div :class=\"$style.commentIcon\">\n              <div style=\"width: 100%; border-radius: 100px; padding: 2vw\">\n                <CommentIcon height=\"100%\" width=\"100%\" color=\"#fff\" />\n              </div>\n            </div>\n          </Col>\n\n          <Col span=\"14\" style=\"padding: 0;\" v-if=\"messageCount.comments.count\">\n            <h4 style=\"font-weight: 400;\">评论的</h4>\n            <div v-if=\"commentLists\" style=\"color: #999; font-size: 12px\">{{ commentsText }} <span v-show=\"messageCount.comments.count > 3\">等人</span>评论了我</div>\n            <div v-else style=\"color: #999; font-size: 12px;\">还没有人评论我</div>\n          </Col>\n\n          <Col span=\"20\" style=\"padding:0 12px 0 0;\" v-else>\n            <h4 style=\"font-weight: 400;\">评论的</h4>\n            <div v-if=\"commentLists\" style=\"color: #999; font-size: 12px;\">{{ commentsText }} <span v-show=\"messageCount.comments.count > 3\">等人</span>评论过我</div>\n            <div v-else style=\"color: #999; font-size: 12px;\">还没有人评论我</div>\n          </Col>\n\n          <Col span=\"6\" v-if=\"messageCount.comments.count\">\n            <timeago :class=$style.time :since=\"commentTime\" locale=\"zh-CN\" :auto-update=\"60\"></timeago>\n            <i :class=\"$style.messageCount\">{{ messageCount.comments.count }}</i>\n          </Col>\n        </div>\n      </Row>\n      <Row :gutter=\"24\" :class=\"$style.entry\">\n        <div :class=\"$style.entryContainer\" @click=\"changeUrl('/users/diggs')\">\n          <Col span=\"4\" :class=\"$style.entryIcon\">\n            <div :class=\"$style.diggIcon\">\n              <div style=\"width: 100%; border-radius: 100px; padding: 2vw\">\n                <DiggIcon height=\"100%\" width=\"100%\" color=\"#fff\" />\n              </div>\n            </div>\n          </Col>\n          <Col span=\"14\" style=\"padding: 0;\" v-if=\"messageCount.diggs.count\">\n            <h4 style=\"font-weight: 400;\">赞过的</h4>\n            <div v-if=\"diggLists\" style=\"color: #999; font-size: 12px;\">{{ diggsText }} <span v-show=\"messageCount.diggs.count > 3\">等人</span>赞了我</div>\n            <div v-else style=\"color: #999; font-size: 12px;\">还没有人赞我</div>\n          </Col>\n          <Col span=\"20\" style=\"padding: 0 12px 0 0;\" v-else>\n            <h4 style=\"font-weight: 400;\">赞过的</h4>\n            <div v-if=\"diggLists\" style=\"color: #999; font-size: 12px;\">{{ diggsText }} <span v-show=\"messageCount.diggs.count > 3\">等人</span>赞过我</div>\n            <div v-else style=\"color: #999; font-size: 12px;\">还没有人赞我</div>\n          </Col>\n          <Col span=\"6\" v-if=\"messageCount.diggs.count\">\n            <timeago :class=$style.time :since=\"diggTime\" locale=\"zh-CN\" :auto-update=\"60\"></timeago>\n            <i :class=\"$style.messageCount\">{{messageCount.diggs.count}}</i>\n          </Col>\n        </div>\n      </Row>\n      <Row :gutter=\"24\" :class=\"$style.entry\" v-for=\"(message, index) in imMessageList\" :key=\"index\">\n        <div :class=\"$style.entryContainer\" @click=\"changeUrl( `/users/message/${message.user_id}/${message.cid}`)\">\n          <Col span=\"4\" :class=\"$style.entryIcon\">\n            <div :class=\"$style.messageAvatar\">\n              <img :class=\"$style.avatar\" :src=\"message.avatar\" />\n            </div>\n          </Col>\n          <Col span=\"14\" style=\"padding: 0;\">\n            <h4 style=\"font-weight: 400;\">{{ message.name }}</h4>\n            <div v-if=\"message.lists.length\" :class=\"$style.messagePreview\">\n              {{ message.lists.length ?  message.lists[message.lists.length - 1].txt  : '' }}\n            </div>\n          </Col>\n          <Col span=\"6\" v-if=\"message.lists.length\" style=\"padding-top: 4px\">\n            <timeago :class=\"$style.timer\" :since=\"message.lists[message.lists.length - 1].time\" locale=\"zh-CN\" :auto-update=\"60\"></timeago>\n            <i v-if=\"message.count\" :class=\"$style.messageCount\">{{message.count || 0}}</i>\n          </Col>\n        </div>\n      </Row>\n    </div>\n    <ToolBar/>\n  </div>\n</template>\n<script>\n  import { NOTICE, TOTALMESSAGELISTS, MESSAGENOTICE, MESSAGELISTS } from '../stores/types';\n  import { createAPI, addAccessToken, createOldAPI } from '../utils/request';\n  import ToolBar from '../components/ToolBar';\n  import { getUserInfo } from '../utils/user';\n  import DiggIcon from '../icons/Digg';\n  import CommentIcon from '../icons/Comment';\n  import timers from '../utils/timer';\n  import { changeUrl } from '../utils/changeUrl';\n  import lodash from 'lodash';\n  import { mapState } from 'vuex';\n\n  const MessageList = {\n    components: {\n      ToolBar,\n      DiggIcon,\n      CommentIcon\n    },\n    data: () => ({\n      messages: {},\n      isWeiXin: TS_WEB.isWeiXin,\n      commentsText: '',\n      diggsText: ''\n    }),\n    computed: {\n      // 消息统计\n      ...mapState({\n        messageCount: state => state.messageCount.messageCount\n      }),\n      imMessageList () {\n        // 获取会话列表\n        let messageList = { ...this.$store.getters[TOTALMESSAGELISTS] };\n        if(!lodash.keys(messageList).length > 0) return {};\n        return messageList;\n      },\n      diggTime () {\n        const { diggs: { time = new window.Date().getTime() } = {} } = this.messageCount;\n        return time;\n      },\n      diggLists () {\n        const { diggs: { uids = [] } = {} } = this.messageCount;\n        let users = '';\n        let count = 0;\n        let newUids = [ ...uids ];\n\n        if(!uids.length) {\n          let oldIds = [];\n          let count = {\n            diggs: {}\n          };\n          window.TS_WEB.dataBase.transaction('rw?', window.TS_WEB.dataBase.diggslist, () => {\n            window.TS_WEB.dataBase.diggslist.where({user_id: window.TS_WEB.currentUserId}).limit(10).toArray().then( result => {\n              if(result.length) {\n                result.forEach( res => {\n                  oldIds.push(res.uid);\n                });\n                count.diggs.count = 0;\n                count.diggs.uids = Array.from(new Set(oldIds));\n                this.$store.dispatch(MESSAGENOTICE, cb => {\n                  cb(count);\n                });\n              }\n            })\n          })\n          return 0;\n        }\n\n        Array.from(new Set(newUids)).slice(0, 3).forEach( (digg, index) => {\n          count ++;\n          if(count > 3) return;\n          let user = this.$storeLocal.get(`user_${digg}`);\n          if(user === undefined) {\n            getUserInfo(digg, 30).then(user => {\n              const { name = '' } = user;\n              users += name + '、';\n              this.diggsText = users.substr(0, users.length - 1);\n            });\n          } else {\n            const { name = '' } = user;\n            users += (name + '、');\n            this.diggsText = users.substr(0, users.length - 1);\n          }\n        });\n        return newUids.length;\n      },\n      commentTime() {\n        const { comments: { time = new window.Date().getTime() } = {} } = this.messageCount;\n        return time;\n      },\n      commentLists () {\n        const { comments: { uids = [] } = {} } = this.messageCount;\n        let users = '';\n        let count = 0;\n        if(!uids.length) {\n          let oldIds = [];\n          let count = {\n            comments: {}\n          };\n          window.TS_WEB.dataBase.transaction('rw?', window.TS_WEB.dataBase.commentslist, () => {\n            window.TS_WEB.dataBase.commentslist.where({user_id: window.TS_WEB.currentUserId}).limit(10).toArray().then( result => {\n              if(result.length) {\n                result.forEach( res => {\n                  oldIds.push(res.uid);\n                });\n                count.comments.count = 0;\n                count.comments.uids = lodash.uniq(oldIds);\n                this.$store.dispatch('GET_USER_BY_ID', uids);\n                this.$store.dispatch(MESSAGENOTICE, cb => {\n                  cb(count);\n                });\n              }\n            })\n          })\n          return 0;\n        }\n\n        uids.slice(0,3).forEach((comment, index) => {\n          count ++;\n          \n          if(count > 3) return;\n          \n          let user = this.$store.getters.getUserById(comment)[0];\n          const { name } = user;\n          users += (name + '、');\n          this.commentsText = users.substr(0, users.length - 1); \n        });\n        return uids.length > 0\n      }\n    },\n    methods: {\n      timers,\n      changeUrl,\n      removeByValue (arr, val) {\n        let newArr = [];\n        for(var i=0; i<arr.length; i++) {\n          if(arr[i] !== parseInt(val)) {\n            newArr.push(arr[i]);\n          }\n        }\n        return newArr;\n      }\n    },\n    created () {\n      let types = 'diggs,comments';\n      let time = 0;\n      time = this.$storeLocal.get('messageFlushTime');\n      let nowtime = parseInt(new window.Date().getTime() / 1000);\n      if(!time) {\n        time = nowtime - 86400;\n      }\n      this.$storeLocal.set('messageFlushTime', nowtime);\n\n      // 获取新消息\n      addAccessToken().get(createOldAPI(`users/flushmessages?key=${types}&time=${time+1}`),{},\n        {\n          validateStatus: status => status === 200\n        }\n      )\n      .then( response => {\n        let datas = response.data.data;\n        let count = {};\n        datas.forEach((data) => {\n          // 消息数量不为空\n          if(data.count) {\n            // 组装数组 写入vuex\n            if(data.key === \"follows\") {\n              count.fans = data.count + this.messageCount[data.key];\n            } else if( data.key === 'comments') {\n              count[data.key] = {};\n              count[data.key].count = data.count + this.messageCount[data.key].count;\n              count[data.key].uids = Array.from(new Set([ ...this.messageCount[data.key].uids, ...data.uids ]));\n              count[data.key].time = this.timers(data.time, 8, false);\n            } else if( data.key === 'diggs') {\n              count[data.key] = {};\n              count[data.key].count = data.count + this.messageCount[data.key].count;\n              count[data.key].uids = Array.from(new Set([ ...this.messageCount[data.key].uids, ...data.uids ]));\n              count[data.key].time = this.timers(data.time, 8, false);\n            }\n          }\n        });\n        this.$store.dispatch(MESSAGENOTICE, cb => {\n          cb(count)\n        });\n      });\n      // 写入聊天对话\n      window.TS_WEB.dataBase.transaction('rw?', window.TS_WEB.dataBase.chatroom, window.TS_WEB.dataBase.messagebase, () => {\n        // 查询当前用户的本地对话\n        window.TS_WEB.dataBase.chatroom\n          .orderBy('last_message_time')\n          .filter( (item) => {\n            return (item.owner === window.TS_WEB.currentUserId);\n          })\n          .limit(10)\n          .reverse()\n          .toArray( results => {\n            if(results.length) {\n              results.forEach( result => {\n                let li = {};\n                let uids = result.uids.split(',');\n                let user_id = 0;\n                if(uids[0] == window.TS_WEB.currentUserId) {\n                  user_id = uids[1];\n                } else {\n                  user_id = uids[0];\n                }\n                window.TS_WEB.dataBase.messagebase\n                .orderBy('seq')\n                .filter( (item) => {\n                  return (item.seq != -1 && item.cid === result.cid);\n                })\n                .limit(15)\n                .reverse()\n                .toArray( array => {\n                  let messageList = [];\n                  let messageBody = {};\n                  if(array.length) {\n                    array = array.reverse();\n                    array.forEach( amessage => {\n                      messageBody.user_id = amessage.uid;\n                      messageBody.txt = amessage.txt;\n                      messageBody.time = amessage.time;\n                      messageBody.addCount = false;\n                      messageList = [ ...messageList, messageBody ];\n                      messageBody = {};\n                    });\n                  }\n                  let item = this.$storeLocal.get(`user_${user_id}`);\n                  if(!item) {\n                    getUserInfo(user_id).then( user => {\n                      li.name = user.name;\n                      li.avatar = user.avatar;\n                      li.lists = messageList;\n                      li.cid = result.cid;\n                      li.user_id = user_id;\n                      this.$store.dispatch(MESSAGELISTS, cb => {\n                        cb(li);\n                      });\n                      li = {};\n                    });\n\n                  } else {\n                    li.name = item.name;\n                    li.avatar = item.avatar;\n                    li.lists = messageList;\n                    li.cid = result.cid;\n                    li.user_id = user_id;\n                    // li.count = 0;\n                    this.$store.dispatch(MESSAGELISTS, cb => {\n                      cb(li);\n                    });\n                    // \n                    li = {};\n                  }\n                });\n              });\n            }\n        })\n      })\n      .catch( e => {\n        console.log(e);\n      })\n    }\n  };\n  export default MessageList;\n</script>\n<style lang=\"less\" module>\n  .timer {\n    font-size: 12px;\n    float: right;\n    color: #999;\n    text-align: right;\n    width: 100%;\n  }\n  .entryLists {\n    padding-bottom: 56px;\n    .entry {\n      height: 70px;\n      display: flex;\n      align-items: center;\n      background: #fff;\n      border-bottom: 1px solid #ededed;\n      .entryContainer {\n        width: 100%;\n        .messagePreview {\n          color: #999;\n          font-size: 12px;\n          text-align: initial;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          display: -webkit-box;\n          -webkit-line-clamp: 1;\n          -webkit-box-orient: vertical;\n          word-break: break-all;\n        }\n        .time {\n          display: flex;\n          justify-content: flex-end;\n          width: 100%;\n          font-size: 12px;\n          color: #999;\n        }\n        .messageCount {\n          padding: 0px 6px;\n          border-radius: 50px;\n          background: #f00;\n          color: #fff;\n          text-align: center;\n          float: right;\n          font-style: normal;\n          font-size: 12px;\n          margin-top: 4px;\n        }\n        .entryIcon {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          .diggIcon {\n            border-radius: 100px;\n            background-color: #fe8f90;\n          }\n          .messageAvatar {\n            .avatar {\n              width: 100%;\n              border-radius: 50%;\n            }\n          }\n          .commentIcon {\n            background-color: rgb(89, 182, 215);\n            border-radius: 100px;\n          }\n        }\n      }\n    }\n  }\n</style>\n\n\n// WEBPACK FOOTER //\n// src/views/Message.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"messageList\"},[_c('div',{staticClass:\"commonHeader\"},[_c('Row',{attrs:{\"gutter\":24}},[_c('Col',{staticClass:\"title-col\",attrs:{\"span\":\"14\",\"offset\":\"5\"}},[_vm._v(\"\\n        消息\\n      \")])],1)],1),_vm._v(\" \"),_c('div',{class:_vm.$style.entryLists},[_c('Row',{class:_vm.$style.entry,attrs:{\"gutter\":24}},[_c('div',{class:_vm.$style.entryContainer,on:{\"click\":function($event){_vm.changeUrl('/users/mycomments')}}},[_c('Col',{class:_vm.$style.entryIcon,attrs:{\"span\":\"4\"}},[_c('div',{class:_vm.$style.commentIcon},[_c('div',{staticStyle:{\"width\":\"100%\",\"border-radius\":\"100px\",\"padding\":\"2vw\"}},[_c('CommentIcon',{attrs:{\"height\":\"100%\",\"width\":\"100%\",\"color\":\"#fff\"}})],1)])]),_vm._v(\" \"),(_vm.messageCount.comments.count)?_c('Col',{staticStyle:{\"padding\":\"0\"},attrs:{\"span\":\"14\"}},[_c('h4',{staticStyle:{\"font-weight\":\"400\"}},[_vm._v(\"评论的\")]),_vm._v(\" \"),(_vm.commentLists)?_c('div',{staticStyle:{\"color\":\"#999\",\"font-size\":\"12px\"}},[_vm._v(_vm._s(_vm.commentsText)+\" \"),_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.messageCount.comments.count > 3),expression:\"messageCount.comments.count > 3\"}]},[_vm._v(\"等人\")]),_vm._v(\"评论了我\")]):_c('div',{staticStyle:{\"color\":\"#999\",\"font-size\":\"12px\"}},[_vm._v(\"还没有人评论我\")])]):_c('Col',{staticStyle:{\"padding\":\"0 12px 0 0\"},attrs:{\"span\":\"20\"}},[_c('h4',{staticStyle:{\"font-weight\":\"400\"}},[_vm._v(\"评论的\")]),_vm._v(\" \"),(_vm.commentLists)?_c('div',{staticStyle:{\"color\":\"#999\",\"font-size\":\"12px\"}},[_vm._v(_vm._s(_vm.commentsText)+\" \"),_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.messageCount.comments.count > 3),expression:\"messageCount.comments.count > 3\"}]},[_vm._v(\"等人\")]),_vm._v(\"评论过我\")]):_c('div',{staticStyle:{\"color\":\"#999\",\"font-size\":\"12px\"}},[_vm._v(\"还没有人评论我\")])]),_vm._v(\" \"),(_vm.messageCount.comments.count)?_c('Col',{attrs:{\"span\":\"6\"}},[_c('timeago',{class:_vm.$style.time,attrs:{\"since\":_vm.commentTime,\"locale\":\"zh-CN\",\"auto-update\":60}}),_vm._v(\" \"),_c('i',{class:_vm.$style.messageCount},[_vm._v(_vm._s(_vm.messageCount.comments.count))])],1):_vm._e()],1)]),_vm._v(\" \"),_c('Row',{class:_vm.$style.entry,attrs:{\"gutter\":24}},[_c('div',{class:_vm.$style.entryContainer,on:{\"click\":function($event){_vm.changeUrl('/users/diggs')}}},[_c('Col',{class:_vm.$style.entryIcon,attrs:{\"span\":\"4\"}},[_c('div',{class:_vm.$style.diggIcon},[_c('div',{staticStyle:{\"width\":\"100%\",\"border-radius\":\"100px\",\"padding\":\"2vw\"}},[_c('DiggIcon',{attrs:{\"height\":\"100%\",\"width\":\"100%\",\"color\":\"#fff\"}})],1)])]),_vm._v(\" \"),(_vm.messageCount.diggs.count)?_c('Col',{staticStyle:{\"padding\":\"0\"},attrs:{\"span\":\"14\"}},[_c('h4',{staticStyle:{\"font-weight\":\"400\"}},[_vm._v(\"赞过的\")]),_vm._v(\" \"),(_vm.diggLists)?_c('div',{staticStyle:{\"color\":\"#999\",\"font-size\":\"12px\"}},[_vm._v(_vm._s(_vm.diggsText)+\" \"),_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.messageCount.diggs.count > 3),expression:\"messageCount.diggs.count > 3\"}]},[_vm._v(\"等人\")]),_vm._v(\"赞了我\")]):_c('div',{staticStyle:{\"color\":\"#999\",\"font-size\":\"12px\"}},[_vm._v(\"还没有人赞我\")])]):_c('Col',{staticStyle:{\"padding\":\"0 12px 0 0\"},attrs:{\"span\":\"20\"}},[_c('h4',{staticStyle:{\"font-weight\":\"400\"}},[_vm._v(\"赞过的\")]),_vm._v(\" \"),(_vm.diggLists)?_c('div',{staticStyle:{\"color\":\"#999\",\"font-size\":\"12px\"}},[_vm._v(_vm._s(_vm.diggsText)+\" \"),_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.messageCount.diggs.count > 3),expression:\"messageCount.diggs.count > 3\"}]},[_vm._v(\"等人\")]),_vm._v(\"赞过我\")]):_c('div',{staticStyle:{\"color\":\"#999\",\"font-size\":\"12px\"}},[_vm._v(\"还没有人赞我\")])]),_vm._v(\" \"),(_vm.messageCount.diggs.count)?_c('Col',{attrs:{\"span\":\"6\"}},[_c('timeago',{class:_vm.$style.time,attrs:{\"since\":_vm.diggTime,\"locale\":\"zh-CN\",\"auto-update\":60}}),_vm._v(\" \"),_c('i',{class:_vm.$style.messageCount},[_vm._v(_vm._s(_vm.messageCount.diggs.count))])],1):_vm._e()],1)]),_vm._v(\" \"),_vm._l((_vm.imMessageList),function(message,index){return _c('Row',{key:index,class:_vm.$style.entry,attrs:{\"gutter\":24}},[_c('div',{class:_vm.$style.entryContainer,on:{\"click\":function($event){_vm.changeUrl( (\"/users/message/\" + (message.user_id) + \"/\" + (message.cid)))}}},[_c('Col',{class:_vm.$style.entryIcon,attrs:{\"span\":\"4\"}},[_c('div',{class:_vm.$style.messageAvatar},[_c('img',{class:_vm.$style.avatar,attrs:{\"src\":message.avatar}})])]),_vm._v(\" \"),_c('Col',{staticStyle:{\"padding\":\"0\"},attrs:{\"span\":\"14\"}},[_c('h4',{staticStyle:{\"font-weight\":\"400\"}},[_vm._v(_vm._s(message.name))]),_vm._v(\" \"),(message.lists.length)?_c('div',{class:_vm.$style.messagePreview},[_vm._v(\"\\n            \"+_vm._s(message.lists.length ?  message.lists[message.lists.length - 1].txt  : '')+\"\\n          \")]):_vm._e()]),_vm._v(\" \"),(message.lists.length)?_c('Col',{staticStyle:{\"padding-top\":\"4px\"},attrs:{\"span\":\"6\"}},[_c('timeago',{class:_vm.$style.timer,attrs:{\"since\":message.lists[message.lists.length - 1].time,\"locale\":\"zh-CN\",\"auto-update\":60}}),_vm._v(\" \"),(message.count)?_c('i',{class:_vm.$style.messageCount},[_vm._v(_vm._s(message.count || 0))]):_vm._e()],1):_vm._e()],1)])})],2),_vm._v(\" \"),_c('ToolBar')],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-5660ebc0\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/Message.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  this[\"$style\"] = require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true,\\\"localIdentName\\\":\\\"[hash:base64]_0\\\",\\\"importLoaders\\\":true,\\\"modules\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-5660ebc0\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Message.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Message.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Message.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-5660ebc0\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Message.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/Message.vue\n// module id = null\n// module chunks = ","// removed by extract-text-webpack-plugin\nmodule.exports = {\"timer\":\"_25SCyJhkgEvfzrK05SAfut_0\",\"entryLists\":\"_3yyncdW8idzL4afUMXEEam_0\",\"entry\":\"_21Ba_uvhmDWHr2tQZUPINg_0\",\"entryContainer\":\"_3N-F6uU0JN-44wpuUornLp_0\",\"messagePreview\":\"_2IhdB-AYP0apGkMD2za_At_0\",\"time\":\"_15XPl6wM0xcIMjJf8B3Iod_0\",\"messageCount\":\"_1fyeGn_Ja44Q6TYOL7kmQ5_0\",\"entryIcon\":\"_3oRXRchEjzHAq4RaTEJtMT_0\",\"diggIcon\":\"_21irCLUROsH8QFiYEYKoYO_0\",\"messageAvatar\":\"_3U7qL2ZG_D9W6mvaDhTjx2_0\",\"avatar\":\"_1RRNCXSJmYxuIoGeUcnYFL_0\",\"commentIcon\":\"_1wOcYPuRyLpoBw4OfSP9be_0\"};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/extract-text-webpack-plugin/dist/loader.js?{\"omit\":1,\"remove\":true}!./node_modules/vue-style-loader!./node_modules/css-loader?{\"sourceMap\":true,\"localIdentName\":\"[hash:base64]_0\",\"importLoaders\":true,\"modules\":true}!./node_modules/vue-loader/lib/style-compiler?{\"vue\":true,\"id\":\"data-v-5660ebc0\",\"scoped\":false,\"hasInlineConfig\":false}!./node_modules/less-loader/dist/cjs.js?{\"sourceMap\":true}!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/views/Message.vue\n// module id = WQPE\n// module chunks = 8"],"sourceRoot":""}